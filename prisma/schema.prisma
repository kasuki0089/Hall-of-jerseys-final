generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Estado {
  uf        String     @id
  nome      String
  enderecos Endereco[]

  @@map("estados")
}

model Endereco {
  id          Int       @id @default(autoincrement())
  endereco    String
  numero      String
  complemento String?
  bairro      String
  cidade      String
  cep         String
  estadoUf    String
  estado      Estado    @relation(fields: [estadoUf], references: [uf])
  usuarios    Usuario[]

  @@index([estadoUf], map: "enderecos_estadoUf_fkey")
  @@map("enderecos")
}

model Cor {
  id       Int       @id @default(autoincrement())
  nome     String    @unique
  codigo   String?
  produtos Produto[]

  @@map("cores")
}

model Tamanho {
  id            Int                 @id @default(autoincrement())
  nome          String              @unique
  ordem         Int                 @unique
  carrinhoItens CarrinhoItem[]
  estoques      EstoquePorTamanho[]
  itensPedido   ItemPedido[]

  @@map("tamanhos")
}

model FormaPagamento {
  id             Int      @id @default(autoincrement())
  tipo           String
  numeroCartao   String?
  nomeCartao     String?
  validadeCartao String?
  bandeiraCartao String?
  usuarioId      Int
  ativo          Boolean  @default(true)
  criadoEm       DateTime @default(now())
  usuario        Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  pedidos        Pedido[]

  @@index([usuarioId], map: "formas_pagamento_usuarioId_fkey")
  @@map("formas_pagamento")
}

model Liga {
  id       Int       @id @default(autoincrement())
  nome     String    @unique
  sigla    String    @unique
  produtos Produto[]
  times    Time[]

  @@map("ligas")
}

model Time {
  id       Int       @id @default(autoincrement())
  nome     String
  sigla    String
  cidade   String
  ligaId   Int
  produtos Produto[]
  liga     Liga      @relation(fields: [ligaId], references: [id])

  @@index([ligaId], map: "times_ligaId_fkey")
  @@map("times")
}

model Produto {
  id                   Int                   @id @default(autoincrement())
  nome                 String
  codigo               String                @unique
  descricao            String?
  modelo               String
  preco                Float
  year                 Int
  serie                String?
  ativo                Boolean               @default(true)
  sale                 Boolean               @default(false)
  imagemUrl            String?
  criadoEm             DateTime              @default(now())
  atualizadoEm         DateTime              @updatedAt
  ligaId               Int
  timeId               Int?
  corId                Int
  avaliacoes           Avaliacao[]
  carrinhoItens        CarrinhoItem[]
  configuracaoEstoque  ConfiguracaoEstoque?
  estoques             EstoquePorTamanho[]
  itensPedido          ItemPedido[]
  movimentacoesEstoque MovimentacaoEstoque[]
  cor                  Cor                   @relation(fields: [corId], references: [id])
  liga                 Liga                  @relation(fields: [ligaId], references: [id])
  time                 Time?                 @relation(fields: [timeId], references: [id])

  @@index([corId], map: "produtos_corId_fkey")
  @@index([ligaId], map: "produtos_ligaId_fkey")
  @@index([timeId], map: "produtos_timeId_fkey")
  @@map("produtos")
}

model EstoquePorTamanho {
  id           Int      @id @default(autoincrement())
  produtoId    Int
  tamanhoId    Int
  quantidade   Int      @default(0)
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  produto      Produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  tamanho      Tamanho  @relation(fields: [tamanhoId], references: [id])

  @@unique([produtoId, tamanhoId])
  @@index([tamanhoId], map: "estoque_por_tamanho_tamanhoId_fkey")
  @@map("estoque_por_tamanho")
}

model ConfiguracaoEstoque {
  id                  Int       @id @default(autoincrement())
  produtoId           Int       @unique
  quantidadeMinima    Int       @default(5)
  quantidadeMaxima    Int       @default(100)
  pontoReposicao      Int       @default(10)
  tempoMedioReposicao Int?
  fornecedor          String?
  custoUltimaCompra   Float?
  dataUltimaCompra    DateTime?
  observacoes         String?
  criadoEm            DateTime  @default(now())
  atualizadoEm        DateTime  @updatedAt
  produto             Produto   @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@map("configuracoes_estoque")
}

model MovimentacaoEstoque {
  id               Int      @id @default(autoincrement())
  produtoId        Int
  tipo             String
  quantidade       Int
  quantidadeAntes  Int
  quantidadeDepois Int
  motivo           String?
  custo            Float?
  valorTotal       Float?
  fornecedor       String?
  notaFiscal       String?
  responsavel      String?
  observacoes      String?
  criadoEm         DateTime @default(now())
  produto          Produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@index([produtoId])
  @@index([tipo])
  @@index([criadoEm])
  @@map("movimentacoes_estoque")
}

model Usuario {
  id               Int              @id @default(autoincrement())
  nome             String
  email            String           @unique
  senha            String
  telefone         String?
  cpf              String?
  dataNascimento   DateTime?
  genero           String?
  role             String           @default("user")
  criadoEm         DateTime         @default(now())
  atualizadoEm     DateTime         @updatedAt
  enderecoId       Int?
  emailVerificado  Boolean          @default(false)
  tokenVerificacao String?
  avaliacoes       Avaliacao[]
  carrinhoItens    CarrinhoItem[]
  formasPagamento  FormaPagamento[]
  pedidos          Pedido[]
  endereco         Endereco?        @relation(fields: [enderecoId], references: [id])

  @@index([enderecoId], map: "usuarios_enderecoId_fkey")
  @@map("usuarios")
}

model Pedido {
  id               Int             @id @default(autoincrement())
  usuarioId        Int
  total            Float
  status           String          @default("pendente")
  criadoEm         DateTime        @default(now())
  atualizadoEm     DateTime        @updatedAt
  confirmadoEm     DateTime?
  transacaoId      String?         @unique
  formaPagamentoId Int?
  itens            ItemPedido[]
  formaPagamento   FormaPagamento? @relation(fields: [formaPagamentoId], references: [id])
  transacao        Transacao?      @relation(fields: [transacaoId], references: [id])
  usuario          Usuario         @relation(fields: [usuarioId], references: [id])

  @@index([formaPagamentoId], map: "pedidos_formaPagamentoId_fkey")
  @@index([usuarioId], map: "pedidos_usuarioId_fkey")
  @@map("pedidos")
}

model ItemPedido {
  id         Int      @id @default(autoincrement())
  pedidoId   Int
  produtoId  Int
  quantidade Int
  preco      Float
  tamanhoId  Int?
  criadoEm   DateTime @default(now())
  pedido     Pedido   @relation(fields: [pedidoId], references: [id])
  produto    Produto  @relation(fields: [produtoId], references: [id])
  tamanho    Tamanho? @relation(fields: [tamanhoId], references: [id])

  @@index([pedidoId], map: "itens_pedido_pedidoId_fkey")
  @@index([produtoId], map: "itens_pedido_produtoId_fkey")
  @@index([tamanhoId], map: "itens_pedido_tamanhoId_fkey")
  @@map("itens_pedido")
}

model CarrinhoItem {
  id         Int      @id @default(autoincrement())
  usuarioId  Int
  produtoId  Int
  quantidade Int
  tamanhoId  Int?
  criadoEm   DateTime @default(now())
  produto    Produto  @relation(fields: [produtoId], references: [id])
  tamanho    Tamanho? @relation(fields: [tamanhoId], references: [id])
  usuario    Usuario  @relation(fields: [usuarioId], references: [id])

  @@unique([usuarioId, produtoId, tamanhoId])
  @@index([produtoId], map: "carrinho_itens_produtoId_fkey")
  @@index([tamanhoId], map: "carrinho_itens_tamanhoId_fkey")
  @@map("carrinho_itens")
}

model Transacao {
  id           String   @id
  pedidoId     Int
  tipo         String
  valor        Float
  status       String
  dadosGateway String?
  erro         String?
  processadoEm DateTime @default(now())
  pedido       Pedido?

  @@map("transacoes")
}

model Avaliacao {
  id           Int      @id @default(autoincrement())
  usuarioId    Int
  produtoId    Int
  nota         Float
  comentario   String?
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  produto      Produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  usuario      Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, produtoId])
  @@index([produtoId])
  @@index([nota])
  @@map("avaliacoes")
}

model Contato {
  id           Int       @id @default(autoincrement())
  nome         String
  email        String
  telefone     String?
  motivo       String
  mensagem     String
  status       String    @default("novo")
  criadoEm     DateTime  @default(now())
  respondidoEm DateTime?

  @@index([status])
  @@index([criadoEm])
  @@map("contatos")
}

model Carousel {
  id          Int      @id @default(autoincrement())
  titulo      String
  descricao   String?  @db.Text
  imagemUrl   String   @db.VarChar(500)
  linkUrl     String?  @db.VarChar(500)
  ativo       Boolean  @default(true)
  ordem       Int      @default(0)
  criadoEm    DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@index([ativo])
  @@index([ordem])
  @@map("carousel")
}
