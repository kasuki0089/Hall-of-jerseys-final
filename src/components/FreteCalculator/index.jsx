'use client';\n\nimport { useState } from 'react';\nimport { Truck, Calculator, MapPin, Clock, Gift } from 'lucide-react';\n\nexport default function FreteCalculator({ produtos = [], onFreteSelected, valorTotal = 0 }) {\n  const [cep, setCep] = useState('');\n  const [opcoesFrete, setOpcoesFrete] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [erro, setErro] = useState('');\n  const [enderecoDestino, setEnderecoDestino] = useState(null);\n  const [freteSelecionado, setFreteSelecionado] = useState(null);\n  const [freteGratis, setFreteGratis] = useState(false);\n\n  const formatarCEP = (value) => {\n    const nums = value.replace(/\\D/g, '');\n    if (nums.length <= 8) {\n      return nums.replace(/^(\\d{5})(\\d)/, '$1-$2');\n    }\n    return nums.substring(0, 8).replace(/^(\\d{5})(\\d)/, '$1-$2');\n  };\n\n  const handleCepChange = (e) => {\n    const formatted = formatarCEP(e.target.value);\n    setCep(formatted);\n    if (formatted.length < 9) {\n      setOpcoesFrete([]);\n      setEnderecoDestino(null);\n      setErro('');\n    }\n  };\n\n  const calcularFrete = async () => {\n    if (cep.length !== 9) {\n      setErro('CEP deve ter 8 dígitos');\n      return;\n    }\n\n    if (!produtos.length) {\n      setErro('Carrinho vazio');\n      return;\n    }\n\n    setLoading(true);\n    setErro('');\n\n    try {\n      const response = await fetch('/api/frete', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          cepDestino: cep,\n          produtos: produtos.map(p => ({\n            id: p.id,\n            quantidade: p.quantidade || 1\n          }))\n        })\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Erro ao calcular frete');\n      }\n\n      setOpcoesFrete(data.opcoesFrete);\n      setEnderecoDestino(data.enderecoDestino);\n      setFreteGratis(data.freteGratis);\n\n    } catch (error) {\n      setErro(error.message);\n      setOpcoesFrete([]);\n      setEnderecoDestino(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const selecionarFrete = (opcao) => {\n    setFreteSelecionado(opcao);\n    if (onFreteSelected) {\n      onFreteSelected(opcao);\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter') {\n      calcularFrete();\n    }\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-md p-6\">\n      <h3 className=\"text-lg font-semibold text-gray-900 flex items-center mb-4\">\n        <Truck className=\"w-5 h-5 mr-2\" />\n        Calcular Frete\n      </h3>\n\n      {/* Input CEP */}\n      <div className=\"flex gap-3 mb-4\">\n        <div className=\"flex-1\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            CEP de entrega\n          </label>\n          <input\n            type=\"text\"\n            value={cep}\n            onChange={handleCepChange}\n            onKeyPress={handleKeyPress}\n            placeholder=\"00000-000\"\n            maxLength=\"9\"\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\"\n          />\n        </div>\n        <div className=\"flex items-end\">\n          <button\n            onClick={calcularFrete}\n            disabled={loading || cep.length !== 9}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\"\n          >\n            {loading ? (\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n            ) : (\n              <>\n                <Calculator className=\"w-4 h-4 mr-2\" />\n                Calcular\n              </>\n            )}\n          </button>\n        </div>\n      </div>\n\n      {/* Erro */}\n      {erro && (\n        <div className=\"bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-md mb-4\">\n          {erro}\n        </div>\n      )}\n\n      {/* Endereço encontrado */}\n      {enderecoDestino && (\n        <div className=\"bg-gray-50 border border-gray-200 rounded-md p-3 mb-4\">\n          <div className=\"flex items-start\">\n            <MapPin className=\"w-4 h-4 text-gray-500 mt-1 mr-2\" />\n            <div className=\"text-sm text-gray-700\">\n              <p><strong>Destino:</strong> {enderecoDestino.cidade}/{enderecoDestino.uf}</p>\n              <p className=\"text-gray-500\">{enderecoDestino.logradouro}, {enderecoDestino.bairro}</p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Frete grátis */}\n      {freteGratis && (\n        <div className=\"bg-green-50 border border-green-200 rounded-md p-3 mb-4\">\n          <div className=\"flex items-center text-green-700\">\n            <Gift className=\"w-4 h-4 mr-2\" />\n            <span className=\"text-sm font-medium\">Você ganhou frete grátis via PAC!</span>\n          </div>\n          <p className=\"text-xs text-green-600 mt-1\">\n            Compras acima de R$ 200 têm frete grátis\n          </p>\n        </div>\n      )}\n\n      {/* Opções de frete */}\n      {opcoesFrete.length > 0 && (\n        <div className=\"space-y-3\">\n          <h4 className=\"font-medium text-gray-900\">Opções de entrega:</h4>\n          \n          {opcoesFrete.map((opcao, index) => (\n            <div\n              key={index}\n              className={`border rounded-lg p-4 cursor-pointer transition-colors ${\n                freteSelecionado?.codigo === opcao.codigo\n                  ? 'border-blue-500 bg-blue-50'\n                  : 'border-gray-200 hover:border-gray-300'\n              }`}\n              onClick={() => selecionarFrete(opcao)}\n            >\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center\">\n                  <input\n                    type=\"radio\"\n                    name=\"frete\"\n                    checked={freteSelecionado?.codigo === opcao.codigo}\n                    onChange={() => selecionarFrete(opcao)}\n                    className=\"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500\"\n                  />\n                  <div className=\"ml-3\">\n                    <div className=\"flex items-center\">\n                      <span className=\"font-medium text-gray-900\">{opcao.nome}</span>\n                      {opcao.preco === 0 && (\n                        <span className=\"ml-2 bg-green-100 text-green-800 text-xs font-medium px-2 py-0.5 rounded-full\">\n                          GRÁTIS\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"flex items-center text-sm text-gray-600 mt-1\">\n                      <Clock className=\"w-3 h-3 mr-1\" />\n                      <span>{opcao.prazo}</span>\n                    </div>\n                    {opcao.promocao && (\n                      <p className=\"text-xs text-green-600 mt-1\">{opcao.promocao}</p>\n                    )}\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <span className={`font-semibold ${\n                    opcao.preco === 0 ? 'text-green-600' : 'text-gray-900'\n                  }`}>\n                    {opcao.preco === 0 ? 'Grátis' : `R$ ${opcao.preco.toFixed(2)}`}\n                  </span>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Observações */}\n      {opcoesFrete.length > 0 && (\n        <div className=\"mt-4 text-xs text-gray-500\">\n          <p>• Prazos não incluem finais de semana e feriados</p>\n          <p>• Frete grátis via PAC para compras acima de R$ 200,00</p>\n          <p>• Produtos enviados pelos Correios ou transportadora</p>\n        </div>\n      )}\n\n      {/* Resumo do frete selecionado */}\n      {freteSelecionado && (\n        <div className=\"mt-4 pt-4 border-t border-gray-200\">\n          <div className=\"bg-blue-50 rounded-lg p-3\">\n            <h5 className=\"font-medium text-blue-900 mb-2\">Frete selecionado:</h5>\n            <div className=\"flex items-center justify-between text-sm\">\n              <span className=\"text-blue-700\">\n                {freteSelecionado.nome} - {freteSelecionado.prazo}\n              </span>\n              <span className=\"font-semibold text-blue-900\">\n                {freteSelecionado.preco === 0 \n                  ? 'Grátis' \n                  : `R$ ${freteSelecionado.preco.toFixed(2)}`\n                }\n              </span>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}"